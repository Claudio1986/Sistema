/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */
package vista;

import Controlador.Factura1;
import Controlador.MaestroFactura1;
import Controlador.producto;
import Controlador.producto1;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.ResultSetMetaData;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.ArrayList;
import java.util.Date;
import java.util.List;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.JOptionPane;
import javax.swing.table.DefaultTableModel;
import modelo.impresion;
import modelo.matematicas;

/**
 *
 * @author claudio
 */
public class VentasConFactura extends javax.swing.JFrame {
private ResultSet rs = null;
private Statement stmt= null;
private ResultSetMetaData  rsm = null;
 private Connection con = null;
 producto miProducto = new producto();
 public int resultado=0;
 public int acumulador=0;
    /**
     * Creates new form VentasConFactura
     */
    public VentasConFactura() {
        initComponents();
        setLocationRelativeTo(null);
        String fecha;
  Date fecha1 = new Date ();
  fecha = fecha1.toLocaleString();
  System.out.println(fecha);
  this.txtFechaEmision.setText(fecha);
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPanel1 = new javax.swing.JPanel();
        lblNombre = new javax.swing.JLabel();
        txtNombre = new javax.swing.JTextField();
        lblApellido = new javax.swing.JLabel();
        txtApellido = new javax.swing.JTextField();
        lblDireccion = new javax.swing.JLabel();
        txtDireccion = new javax.swing.JTextField();
        lblOrden = new javax.swing.JLabel();
        txtOrdenDeCompra = new javax.swing.JTextField();
        lblRuc = new javax.swing.JLabel();
        txtRut = new javax.swing.JTextField();
        lblNumGuia = new javax.swing.JLabel();
        txtNumeroGuia = new javax.swing.JTextField();
        lblCondicionPago = new javax.swing.JLabel();
        txtCondicionDePago = new javax.swing.JTextField();
        lblFechEmision = new javax.swing.JLabel();
        txtFechaEmision = new javax.swing.JTextField();
        jLabel14 = new javax.swing.JLabel();
        jLabel10 = new javax.swing.JLabel();
        lblFechVenc = new javax.swing.JLabel();
        txtFechaVencimiento = new javax.swing.JTextField();
        jPanel4 = new javax.swing.JPanel();
        btnAgregar = new javax.swing.JButton();
        btnEliminar = new javax.swing.JButton();
        btnLImpiar = new javax.swing.JButton();
        btnImprimir = new javax.swing.JButton();
        jScrollPane1 = new javax.swing.JScrollPane();
        jTable1 = new javax.swing.JTable();
        lblTotal = new javax.swing.JLabel();
        lblIgv = new javax.swing.JLabel();
        jPanel9 = new javax.swing.JPanel();
        txtTotal1 = new javax.swing.JTextField();
        txtIVA = new javax.swing.JTextField();
        txtSubtotal = new javax.swing.JTextField();
        jLabel1 = new javax.swing.JLabel();
        lblSubtotal = new javax.swing.JLabel();
        txtCodigo = new javax.swing.JTextField();
        txtTipo = new javax.swing.JTextField();
        txtPrecio = new javax.swing.JTextField();
        jButton1 = new javax.swing.JButton();
        txtCantidadT = new javax.swing.JTextField();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);

        jPanel1.setBorder(javax.swing.BorderFactory.createEmptyBorder(5, 5, 5, 5));
        jPanel1.setLayout(new java.awt.GridLayout(5, 4, 5, 5));

        lblNombre.setText("Nombre:");
        jPanel1.add(lblNombre);
        jPanel1.add(txtNombre);

        lblApellido.setText("Apellido:");
        jPanel1.add(lblApellido);

        txtApellido.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtApellidoActionPerformed(evt);
            }
        });
        jPanel1.add(txtApellido);

        lblDireccion.setText("Dirección:");
        jPanel1.add(lblDireccion);
        jPanel1.add(txtDireccion);

        lblOrden.setText("Orden de compra:");
        jPanel1.add(lblOrden);
        jPanel1.add(txtOrdenDeCompra);

        lblRuc.setText("Rut:");
        jPanel1.add(lblRuc);
        jPanel1.add(txtRut);

        lblNumGuia.setText("Número de Guía");
        jPanel1.add(lblNumGuia);
        jPanel1.add(txtNumeroGuia);

        lblCondicionPago.setText("Condición de pago:");
        jPanel1.add(lblCondicionPago);

        txtCondicionDePago.setText("Pagadero en 30-60 días");
        jPanel1.add(txtCondicionDePago);

        lblFechEmision.setText("Fecha de emisión:");
        jPanel1.add(lblFechEmision);

        txtFechaEmision.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtFechaEmisionActionPerformed(evt);
            }
        });
        jPanel1.add(txtFechaEmision);
        jPanel1.add(jLabel14);
        jPanel1.add(jLabel10);

        lblFechVenc.setText("Fecha de vencimiento:");
        jPanel1.add(lblFechVenc);
        jPanel1.add(txtFechaVencimiento);

        btnAgregar.setText("Agregar");
        btnAgregar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnAgregarActionPerformed(evt);
            }
        });
        jPanel4.add(btnAgregar);

        btnEliminar.setText("Eliminar");
        btnEliminar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnEliminarActionPerformed(evt);
            }
        });
        jPanel4.add(btnEliminar);

        btnLImpiar.setText("Limpiar");
        btnLImpiar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnLImpiarActionPerformed(evt);
            }
        });
        jPanel4.add(btnLImpiar);

        btnImprimir.setText("Imprimir");
        btnImprimir.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                btnImprimirMouseClicked(evt);
            }
        });
        btnImprimir.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnImprimirActionPerformed(evt);
            }
        });
        jPanel4.add(btnImprimir);

        jTable1.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "Cantidad", "Descripción", "P. Unit.", "Total"
            }
        ) {
            Class[] types = new Class [] {
                java.lang.Integer.class, java.lang.String.class, java.lang.Double.class, java.lang.Double.class
            };

            public Class getColumnClass(int columnIndex) {
                return types [columnIndex];
            }
        });
        jScrollPane1.setViewportView(jTable1);

        lblTotal.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        lblTotal.setText("Total:");
        lblTotal.setHorizontalTextPosition(javax.swing.SwingConstants.RIGHT);

        lblIgv.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        lblIgv.setText("I.V.A.");
        lblIgv.setHorizontalTextPosition(javax.swing.SwingConstants.RIGHT);

        jPanel9.setPreferredSize(new java.awt.Dimension(120, 60));
        jPanel9.setLayout(new java.awt.GridLayout(3, 1, 5, 5));

        txtTotal1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtTotal1ActionPerformed(evt);
            }
        });
        jPanel9.add(txtTotal1);
        jPanel9.add(txtIVA);

        txtSubtotal.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtSubtotalActionPerformed(evt);
            }
        });
        jPanel9.add(txtSubtotal);

        jLabel1.setFont(new java.awt.Font("Tahoma", 1, 18)); // NOI18N
        jLabel1.setText("PANTALLA COMPRAS");

        lblSubtotal.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        lblSubtotal.setText("Subtotal:");
        lblSubtotal.setHorizontalTextPosition(javax.swing.SwingConstants.RIGHT);

        txtCodigo.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtCodigoActionPerformed(evt);
            }
        });

        jButton1.setIcon(new javax.swing.ImageIcon(getClass().getResource("/modelo/atras3.png"))); // NOI18N
        jButton1.setText("Volver");
        jButton1.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                jButton1MouseClicked(evt);
            }
        });
        jButton1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton1ActionPerformed(evt);
            }
        });

        txtCantidadT.setText("1");

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                .addGap(25, 25, 25)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(txtTipo, javax.swing.GroupLayout.DEFAULT_SIZE, 54, Short.MAX_VALUE)
                    .addComponent(txtPrecio))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(lblIgv, javax.swing.GroupLayout.PREFERRED_SIZE, 488, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(0, 0, Short.MAX_VALUE))
                    .addGroup(layout.createSequentialGroup()
                        .addGap(0, 0, Short.MAX_VALUE)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(lblSubtotal, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.PREFERRED_SIZE, 78, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(lblTotal, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.PREFERRED_SIZE, 488, javax.swing.GroupLayout.PREFERRED_SIZE))))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jPanel9, javax.swing.GroupLayout.PREFERRED_SIZE, 161, javax.swing.GroupLayout.PREFERRED_SIZE))
            .addGroup(layout.createSequentialGroup()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                        .addContainerGap(136, Short.MAX_VALUE)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jPanel4, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.PREFERRED_SIZE, 613, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jScrollPane1, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.PREFERRED_SIZE, 613, javax.swing.GroupLayout.PREFERRED_SIZE)))
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(layout.createSequentialGroup()
                                .addGap(205, 205, 205)
                                .addComponent(jLabel1))
                            .addGroup(layout.createSequentialGroup()
                                .addGap(103, 103, 103)
                                .addComponent(txtCodigo, javax.swing.GroupLayout.PREFERRED_SIZE, 161, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addGap(127, 127, 127)
                                .addComponent(txtCantidadT, javax.swing.GroupLayout.PREFERRED_SIZE, 51, javax.swing.GroupLayout.PREFERRED_SIZE)))
                        .addGap(0, 0, Short.MAX_VALUE)))
                .addContainerGap())
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(jButton1, javax.swing.GroupLayout.PREFERRED_SIZE, 95, javax.swing.GroupLayout.PREFERRED_SIZE))
            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                    .addContainerGap(68, Short.MAX_VALUE)
                    .addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, 623, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addContainerGap(68, Short.MAX_VALUE)))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                .addComponent(jLabel1)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 153, Short.MAX_VALUE)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(txtCodigo, javax.swing.GroupLayout.PREFERRED_SIZE, 24, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(txtCantidadT, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(18, 18, 18)
                .addComponent(jPanel4, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 133, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(lblSubtotal, javax.swing.GroupLayout.PREFERRED_SIZE, 18, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(layout.createSequentialGroup()
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                .addComponent(lblIgv, javax.swing.GroupLayout.PREFERRED_SIZE, 21, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addGroup(layout.createSequentialGroup()
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(txtTipo, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(lblTotal, javax.swing.GroupLayout.PREFERRED_SIZE, 21, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(txtPrecio, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)))
                    .addComponent(jPanel9, javax.swing.GroupLayout.PREFERRED_SIZE, 83, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(jButton1, javax.swing.GroupLayout.PREFERRED_SIZE, 31, javax.swing.GroupLayout.PREFERRED_SIZE))
            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addGroup(layout.createSequentialGroup()
                    .addGap(20, 20, 20)
                    .addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, 142, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addContainerGap(363, Short.MAX_VALUE)))
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void txtFechaEmisionActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtFechaEmisionActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_txtFechaEmisionActionPerformed

    private void btnAgregarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnAgregarActionPerformed
        // TODO add your handling code here:
       /* DefaultTableModel modelo = (DefaultTableModel) jTable1.getModel();
        modelo.addRow(new Object[]
            {0, "Producto de prueba", matematicas.redondear(Math.random()), 0.0d});
        jTable1.updateUI();*/
        DefaultTableModel modelo = (DefaultTableModel) jTable1.getModel();
        if(this.txtApellido.getText().equals("")||this.txtNombre.equals("")||this.txtIVA.equals("")){
        JOptionPane.showMessageDialog(this, "INGRESE DATOS");
        }
        else{
        int z=0;
        String Datos[]= new String[3];
        Datos[0]=this.txtNombre.getText();
        this.txtNombre.setText(null);
        Datos[1]=this.txtApellido.getText();
        this.txtApellido.setText(null);
        Datos[2]=this.txtRut.getText();
        this.txtRut.setText(null);
        modelo.addRow(Datos);
        this.txtNombre.grabFocus();
        z = modelo.getRowCount();
        this.txtIVA.setText(""+z);
         modelo.addRow(new Object[]
            {0, "Producto de prueba", matematicas.redondear(Math.random()), 0.0d});
        jTable1.updateUI();}
    }//GEN-LAST:event_btnAgregarActionPerformed

    private void btnEliminarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnEliminarActionPerformed
        // TODO add your handling code here:
        int fila = jTable1.getSelectedRow();
        if (fila >= 0) {
            DefaultTableModel modelo = (DefaultTableModel) jTable1.getModel();
            modelo.removeRow(fila);
            jTable1.updateUI();
        }
    }//GEN-LAST:event_btnEliminarActionPerformed

    private void btnLImpiarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnLImpiarActionPerformed
        // TODO add your handling code here:.DefaultTableModel modelo = (DefaultTableModel) jTable1.getModel();
        DefaultTableModel modelo = (DefaultTableModel) jTable1.getModel();
        modelo.setRowCount(0);
        jTable1.updateUI();
    }//GEN-LAST:event_btnLImpiarActionPerformed

    private void btnImprimirMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_btnImprimirMouseClicked
        // TODO add your handling code here:
    }//GEN-LAST:event_btnImprimirMouseClicked

    private void btnImprimirActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnImprimirActionPerformed
        // TODO add your handling code here:
        MaestroFactura1 maestro = new MaestroFactura1();
        List<producto1> productos = new ArrayList<producto1>();
        maestro.setNombreCliente(txtNombre.getText());
        maestro.setApellidoCliente(txtApellido.getText());
        maestro.setDireccionCliente(txtDireccion.getText());
        maestro.setOrdenCompra(txtOrdenDeCompra.getText());
        maestro.setRuc(txtRut.getText());
        maestro.setNumeroGuia(txtNumeroGuia.getText());
        maestro.setCondicionPago(txtCondicionDePago.getText());
        maestro.setFechaEmision(txtFechaEmision.getText());
        maestro.setFechaVencimiento(txtFechaVencimiento.getText());
        Factura1 factura = new Factura1();
        factura.setMaestro(maestro);
        int numeroMateriales = jTable1.getRowCount();
        double subtotal = 0d;
        for (int i = 0; i < numeroMateriales; i++) {
            int cantidad = Integer.parseInt(this.txtCantidadT.getText());
            String descripcion = (String) jTable1.getValueAt(i, 2);
            double precioUnitario = (Double) jTable1.getValueAt(i, 3);
           
            double precioParcial = precioUnitario * cantidad;
            subtotal += precioParcial;
            jTable1.setValueAt(precioParcial, i, 3);
            producto1 producto = new producto1();
            producto.setCantidad(cantidad);
            producto.setDescripcion(descripcion);
            producto.setPrecioParcial(precioParcial);
            producto.setPrecioUnitario(precioUnitario);
            productos.add(producto);
        }
        txtSubtotal.setText("" + subtotal);
       this.txtIVA.setText("" + (double) (0.18 * subtotal));
        
        this.txtTotal1.setText("" + (double) (1.18 * subtotal));
        jTable1.updateUI();
        factura.setProductos(productos);
        impresion p = new impresion(factura);
        p.generarArchivoPDF();
    }//GEN-LAST:event_btnImprimirActionPerformed
private void calcular(int rescueValor){
       acumulador=acumulador+rescueValor;
   //   JOptionPane.showMessageDialog(this,acumulador);
       this.txtSubtotal.setText(""+acumulador);
      
 }
    private void txtApellidoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtApellidoActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_txtApellidoActionPerformed

    private void txtTotal1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtTotal1ActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_txtTotal1ActionPerformed

    private void txtSubtotalActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtSubtotalActionPerformed
        
    }//GEN-LAST:event_txtSubtotalActionPerformed
private void actualizarStock(String codigoBarra,int cantidad) throws SQLException{
      String conexion = "jdbc:odbc:venta";
        try {
     con= DriverManager.getConnection(conexion, "root","1234");
     } catch (Exception e) {   JOptionPane.showMessageDialog(null,"no conecto");}
        String serieProducto =this.txtCodigo.getText();
        String consultaStockactual="select stockactual as Total from producto where serieproducto='"+serieProducto+"'";
       try {stmt = con.createStatement();
        rs = stmt.executeQuery(consultaStockactual);
        } catch (Exception e) {System.out.println("error en la consulta: " + serieProducto);}
        try {
            while (rs.next()) {
                resultado = Integer.parseInt(rs.getString("Total"));
                System.out.println(resultado);
                
               
            }
            

       
         //   return true;
        } catch (SQLException ex) {
          
        }
        
        
    int exito=0;
      
        try {
     con= DriverManager.getConnection(conexion, "root","1234");
     } catch (Exception e) {   JOptionPane.showMessageDialog(null,"no conecto");}
       int stock=resultado-1;
       
       
      String sentenciaActualizacion = "update producto " +
             "set STOCKACTUAL="+stock +" where serieproducto = '"+ this.txtCodigo.getText()+"'";
            System.out.println(sentenciaActualizacion);
       try{ stmt=con.createStatement();
       exito = stmt.executeUpdate(sentenciaActualizacion);
       JOptionPane.showMessageDialog(this,"actualizado con exito");
       //this.txtCodigo.setText("");
       }
       catch(Exception e ){System.out.println("error en la actualizacion");}
       
       
       
        
    
  stmt.close();
  con.close();
  stmt.close();
 }
   
    private void txtCodigoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtCodigoActionPerformed

        int cantidad=1;
       
           if(this.txtCodigo.getText().equals("")){
       
       JOptionPane.showMessageDialog(this, "DEBES INGRESAR EL CODIGO A BUSCAR");
   }else{
    String codigoBarra =this.txtCodigo.getText();
   // int Cantidad  =     Integer.parseInt(txtCantidad.getText());
    
    int Cantidad=1;
     int valor1=0;
       int valor2=0;
    
      
       
         int valor=0;
         valor1=miProducto.getPrecioventa();
        miProducto.Buscar(codigoBarra);
         try {
             actualizarStock(codigoBarra,cantidad);
           miProducto.consultarStock(codigoBarra);
       } catch (SQLException ex) {
           Logger.getLogger(frmProducto.class.getName()).log(Level.SEVERE, null, ex);
       }
       
         
         this.txtTipo.setText(miProducto.getTipo());
         this.txtPrecio.setText(""+miProducto.getPrecioventa());
       int n=0;
       int numero=0;
         
         
           
           
        

        
        
     
       
           try{      
        
   DefaultTableModel modelo = new DefaultTableModel();
   //this.jt1.setModel(vista);
   this.jTable1.setModel(modelo);


   String conexion = "jdbc:odbc:venta";
           try {
        con= DriverManager.getConnection(conexion, "root","1234");
        } catch (Exception e) {   JOptionPane.showMessageDialog(null,"no conecto");}
         String consulta = "select CODPRODUCTO AS CODIGO,MARCA,TIPO as DESCRIPCION,PRECIOVENTA as PRECIO_UNITARIO FROM PRODUCTO WHERE SERIEPRODUCTO='"+codigoBarra+"'";
      // System.out.println(consulta);
       try{stmt=con.createStatement();
       rs=stmt.executeQuery(consulta);
       }catch (Exception e){System.out.println ("error en la consulta");}
       ResultSetMetaData rsm = rs.getMetaData();
       int cantidadColumnas = rsm.getColumnCount();
       for(int i =1;i<=cantidadColumnas;i++)
       { modelo.addColumn(rsm.getColumnLabel(i));}
       while(rs.next()){
       Object[] fila = new Object[cantidadColumnas];
       for(int i = 0;i<cantidadColumnas;i++){
       fila[i]=rs.getObject(i+1);
       
       
      }
       modelo.addRow(fila);
       }
    
      
   // rs.close();
   }catch (Exception ex){ex.printStackTrace();}
           
           
   }  
   String codigoBarra =this.txtCodigo.getText();
   String conexion = "jdbc:odbc:venta";
           try {
        con= DriverManager.getConnection(conexion, "root","1234");
        } catch (Exception e) {   JOptionPane.showMessageDialog(null,"no conecto");}
         String consulta2 = "select PRECIOVENTA FROM PRODUCTO WHERE SERIEPRODUCTO='"+codigoBarra+"'";
          
       //System.out.println(consulta2);
       try{stmt=con.createStatement();
       rs=stmt.executeQuery(consulta2);
       }catch (Exception e){System.out.println ("error en la consulta");}
       
   int recueValor=0;
   //int cantidad2=Integer.parseInt(this.txtCantidad.getText());
   int cantidad2=1;
       try {
           while(rs.next()){
           int rescueValor = rs.getInt("PRECIOVENTA");
           calcular(rescueValor);
           this.txtCodigo.setText("");
             }
       } catch (SQLException ex) {
           Logger.getLogger(frmVentas.class.getName()).log(Level.SEVERE, null, ex);
       }
      
       
       
    
           // TODO add your handling code here:
    }//GEN-LAST:event_txtCodigoActionPerformed

    private void jButton1MouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jButton1MouseClicked
        framePrincipal formInicial = new framePrincipal();
        formInicial.setVisible(true);
        this.dispose();
        //frmPrincipal  = new frmPrincipal();

    }//GEN-LAST:event_jButton1MouseClicked

    private void jButton1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton1ActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_jButton1ActionPerformed

    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(VentasConFactura.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(VentasConFactura.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(VentasConFactura.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(VentasConFactura.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new VentasConFactura().setVisible(true);
            }
        });
    }
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btnAgregar;
    private javax.swing.JButton btnEliminar;
    private javax.swing.JButton btnImprimir;
    private javax.swing.JButton btnLImpiar;
    private javax.swing.JButton jButton1;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel10;
    private javax.swing.JLabel jLabel14;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel4;
    private javax.swing.JPanel jPanel9;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JTable jTable1;
    private javax.swing.JLabel lblApellido;
    private javax.swing.JLabel lblCondicionPago;
    private javax.swing.JLabel lblDireccion;
    private javax.swing.JLabel lblFechEmision;
    private javax.swing.JLabel lblFechVenc;
    private javax.swing.JLabel lblIgv;
    private javax.swing.JLabel lblNombre;
    private javax.swing.JLabel lblNumGuia;
    private javax.swing.JLabel lblOrden;
    private javax.swing.JLabel lblRuc;
    private javax.swing.JLabel lblSubtotal;
    private javax.swing.JLabel lblTotal;
    private javax.swing.JTextField txtApellido;
    private javax.swing.JTextField txtCantidadT;
    private javax.swing.JTextField txtCodigo;
    private javax.swing.JTextField txtCondicionDePago;
    private javax.swing.JTextField txtDireccion;
    private javax.swing.JTextField txtFechaEmision;
    private javax.swing.JTextField txtFechaVencimiento;
    private javax.swing.JTextField txtIVA;
    private javax.swing.JTextField txtNombre;
    private javax.swing.JTextField txtNumeroGuia;
    private javax.swing.JTextField txtOrdenDeCompra;
    private javax.swing.JTextField txtPrecio;
    private javax.swing.JTextField txtRut;
    private javax.swing.JTextField txtSubtotal;
    private javax.swing.JTextField txtTipo;
    private javax.swing.JTextField txtTotal1;
    // End of variables declaration//GEN-END:variables
}
